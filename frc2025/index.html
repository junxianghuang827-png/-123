<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRC 2025 Scout App</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .counter-btn { @apply bg-blue-500 text-white w-12 h-12 rounded-full text-2xl font-bold active:bg-blue-700; }
        .score-box { @apply flex justify-between items-center bg-gray-50 p-3 rounded-lg border; }
    </style>
</head>
<body class="bg-gray-100 select-none">
    <div class="max-w-md mx-auto pb-20">
        <!-- 標題 -->
        <div class="bg-blue-600 text-white p-4 sticky top-0 z-10 shadow-md">
            <h1 class="text-xl font-bold text-center">REEFSCAPE 2025 Scouting</h1>
            <div class="flex gap-2 mt-2">
                <input id="team" type="number" placeholder="隊號" class="w-1/2 p-2 rounded text-black text-center">
                <input id="match" type="number" placeholder="場次" class="w-1/2 p-2 rounded text-black text-center">
            </div>
        </div>

        <div class="p-4 space-y-6">
            <!-- 自動化階段 -->
            <section class="bg-white p-4 rounded-xl shadow">
                <h2 class="text-orange-600 font-black border-b pb-2 mb-3">AUTO (15s)</h2>
                <div class="flex items-center gap-4 mb-4">
                    <input type="checkbox" id="auto_leave" class="w-6 h-6"> 
                    <label for="auto_leave">離開起始線 (Leave)</label>
                </div>
                <div class="space-y-3">
                    <div class="score-box">
                        <span>Coral (珊瑚)</span>
                        <div class="flex items-center gap-3">
                            <button onclick="change('auto_coral', -1)" class="counter-btn">-</button>
                            <span id="auto_coral" class="w-4 text-center font-bold">0</span>
                            <button onclick="change('auto_coral', 1)" class="counter-btn">+</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 手控階段 -->
            <section class="bg-white p-4 rounded-xl shadow">
                <h2 class="text-blue-600 font-black border-b pb-2 mb-3">TELEOP (135s)</h2>
                <div class="grid grid-cols-1 gap-3">
                    <p class="text-sm font-bold text-gray-500">珊瑚得分 (Coral Levels)</p>
                    <div class="score-box"><span>L4 (頂層)</span><div class="flex gap-3 items-center"><button onclick="change('l4',-1)" class="counter-btn">-</button><span id="l4" class="font-bold">0</span><button onclick="change('l4',1)" class="counter-btn">+</button></div></div>
                    <div class="score-box"><span>L3</span><div class="flex gap-3 items-center"><button onclick="change('l3',-1)" class="counter-btn">-</button><span id="l3" class="font-bold">0</span><button onclick="change('l3',1)" class="counter-btn">+</button></div></div>
                    <div class="score-box"><span>L2</span><div class="flex gap-3 items-center"><button onclick="change('l2',-1)" class="counter-btn">-</button><span id="l2" class="font-bold">0</span><button onclick="change('l2',1)" class="counter-btn">+</button></div></div>
                    <div class="score-box"><span>L1 (底層)</span><div class="flex gap-3 items-center"><button onclick="change('l1',-1)" class="counter-btn">-</button><span id="l1" class="font-bold">0</span><button onclick="change('l1',1)" class="counter-btn">+</button></div></div>
                </div>
                <div class="mt-4 border-t pt-4">
                    <p class="text-sm font-bold text-gray-500">海藻處理 (Algae)</p>
                    <div class="score-box mt-2"><span>移除/處理海藻</span><div class="flex gap-3 items-center"><button onclick="change('algae',-1)" class="counter-btn">-</button><span id="algae" class="font-bold">0</span><button onclick="change('algae',1)" class="counter-btn">+</button></div></div>
                </div>
            </section>

            <!-- 殘局階段 -->
            <section class="bg-white p-4 rounded-xl shadow">
                <h2 class="text-purple-600 font-black border-b pb-2 mb-3">ENDGAME (Barge)</h2>
                <select id="endgame" class="w-full p-3 border rounded-lg bg-gray-50 font-bold">
                    <option value="0">無 (None)</option>
                    <option value="2">停泊 (Park)</option>
                    <option value="6">淺層攀爬 (Shallow Climb)</option>
                    <option value="12">深層攀爬 (Deep Climb)</option>
                </select>
            </section>
        </div>

        <!-- 底部生成區 -->
        <div class="fixed bottom-0 left-0 right-0 p-4 bg-white border-t flex justify-center shadow-lg">
            <button onclick="showQR()" class="bg-blue-600 text-white w-full py-4 rounded-xl font-black text-xl">生成數據碼 (GENERATE)</button>
        </div>
    </div>

    <!-- QR 彈窗 -->
    <div id="qr-modal" class="fixed inset-0 bg-black bg-opacity-90 z-50 hidden flex flex-col items-center justify-center p-6 text-white text-center">
        <h2 class="text-2xl font-bold mb-4">掃描數據</h2>
        <div id="qrcode" class="bg-white p-4 rounded-lg mb-6"></div>
        <button onclick="closeQR()" class="bg-red-500 px-8 py-3 rounded-full font-bold">關閉 (CLOSE)</button>
    </div>

    <script>
        let data = { auto_coral: 0, l4: 0, l3: 0, l2: 0, l1: 0, algae: 0 };
        function change(f, d) { data[f] = Math.max(0, data[f] + d); document.getElementById(f).innerText = data[f]; }

        function showQR() {
            const team = document.getElementById('team').value;
            const match = document.getElementById('match').value;
            const auto_leave = document.getElementById('auto_leave').checked ? 1 : 0;
            const endgame = document.getElementById('endgame').value;
            
            if(!team || !match) return alert("請輸入隊號與場次");

            // 格式: 隊號|場次|AutoL|AutoC|L4|L3|L2|L1|Algae|Endgame
            const str = `${team}|${match}|${auto_leave}|${data.auto_coral}|${data.l4}|${data.l3}|${data.l2}|${data.l1}|${data.algae}|${endgame}`;
            
            document.getElementById('qrcode').innerHTML = "";
            new QRCode(document.getElementById("qrcode"), { text: str, width: 256, height: 256 });
            document.getElementById('qr-modal').classList.remove('hidden');
        }

        function closeQR() { document.getElementById('qr-modal').classList.add('hidden'); }

        // 註冊 Service Worker 實現 PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js');
            });
        }
    </script>
</body>
</html>